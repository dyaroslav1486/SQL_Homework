SELECT g.name AS genre, COUNT(ag.artist_id) AS artist_count
FROM Genre g
LEFT JOIN Artist_Genre ag ON g.genre_id = ag.genre_id
GROUP BY g.genre_id, g.name;

SELECT COUNT(t.track_id) AS track_count
FROM Track t
JOIN Album a ON t.album_id = a.album_id
WHERE a.release_year BETWEEN 2019 AND 2020;

SELECT a.title AS album, AVG(t.duration) AS avg_duration
FROM Album a
JOIN Track t ON a.album_id = t.album_id
GROUP BY a.album_id, a.title;

SELECT ar.name
FROM Artist ar
WHERE ar.artist_id NOT IN (
    SELECT aa.artist_id
    FROM Artist_Album aa
    JOIN Album a ON aa.album_id = a.album_id
    WHERE a.release_year = 2020
);


SELECT DISTINCT c.title AS collection
FROM Collection c
JOIN Track_Collection tc ON c.collection_id = tc.collection_id
JOIN Track t ON tc.track_id = t.track_id
JOIN Album a ON t.album_id = a.album_id
JOIN Artist_Album aa ON a.album_id = aa.album_id
JOIN Artist ar ON aa.artist_id = ar.artist_id
WHERE ar.name = 'DJ NullPointer';

SELECT DISTINCT al.title
FROM Album al
JOIN Artist_Album aa ON al.album_id = aa.album_id
JOIN Artist ar ON aa.artist_id = ar.artist_id
JOIN Artist_Genre ag ON ar.artist_id = ag.artist_id
GROUP BY al.album_id, al.title, ar.artist_id
HAVING COUNT(DISTINCT ag.genre_id) > 1;

SELECT t.title
FROM Track t
LEFT JOIN Track_Collection tc ON t.track_id = tc.track_id
WHERE tc.track_id IS NULL;

SELECT DISTINCT ar.name, t.title, t.duration
FROM Track t
JOIN Album al ON t.album_id = al.album_id
JOIN Artist_Album aa ON al.album_id = aa.album_id
JOIN Artist ar ON aa.artist_id = ar.artist_id
WHERE t.duration = (SELECT MIN(duration) FROM Track);

SELECT DISTINCT ar.name, t.title, t.duration
FROM Track t
JOIN Album al ON t.album_id = al.album_id
JOIN Artist_Album aa ON al.album_id = aa.album_id
JOIN Artist ar ON aa.artist_id = ar.artist_id
WHERE t.duration = (SELECT MIN(duration) FROM Track);

SELECT al.title, COUNT(t.track_id) AS track_count
FROM Album al
JOIN Track t ON al.album_id = t.album_id
GROUP BY al.album_id, al.title
HAVING COUNT(t.track_id) = (
    SELECT MIN(track_count)
    FROM (
        SELECT COUNT(t2.track_id) AS track_count
        FROM Album al2
        JOIN Track t2 ON al2.album_id = t2.album_id
        GROUP BY al2.album_id
    ) AS sub
);